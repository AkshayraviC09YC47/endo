
function assertInteropNameCollisions({ moduleReference, expect, name }) {
  const whatWeGot = stableOrderJson(moduleReference)
  if (whatWeGot !== expect) {
    throw Error(`Importing .mjs file '${name}' should return a working set of its exports.
    What we got     : ${whatWeGot}
    What we expected: ${expect}`)
  }
}

function stableOrderJson(obj) {
  return JSON.stringify(obj, Object.keys(obj).sort());
}

async function moduleFromMjs() {
  const whatWouldNodejsDo = '{"default":{"nameCollision":1},"nameCollision":3,"notDefault":2}'
  const mjsinterop = await import('./mjsinterop.mjs');
  assertInteropNameCollisions({
    name: 'mjsinterop',
    moduleReference: mjsinterop,
    expect: whatWouldNodejsDo,
  })
}